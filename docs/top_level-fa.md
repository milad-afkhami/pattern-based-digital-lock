> **[๐ฌ๐ง English Version](top_level.md)**

# ฺฉูพุงุฑฺูโุณุงุฒ ุณุณุชู ุณุทุญ ุจุงูุง

**ูุงู**: `src/top_level.vhd`
**ุชุนุฏุงุฏ ุฎุทูุท**: ฑตด
**ูุฏู**: ฺฉูพุงุฑฺูโุณุงุฒ ููู ุงุฌุฒุง ุฏุฑ ฺฉ ุณุณุชู ฺฉุงูู ุขูุงุฏู ุจุฑุง ุณูุชุฒ

---

## ููุฑุณุช ูุทุงูุจ

- [ููุฏูู](#ููุฏูู)
- [ูููุฏุงุฑ ุจููฺฉ ุณุณุชู](#ูููุฏุงุฑ-ุจููฺฉ-ุณุณุชู)
- [ูุงุณุท ููุฌูุฏุช](#ูุงุณุท-ููุฌูุฏุช)
- [ูุนูุงุฑ](#ูุนูุงุฑ)
- [ุงุชุตุงูุงุช ุงุฌุฒุง](#ุงุชุตุงูุงุช-ุงุฌุฒุง)
- [ุฑุงูููุง ูพฺฉุฑุจูุฏ](#ุฑุงูููุง-ูพฺฉุฑุจูุฏ)
- [ูฺฏุงุดุช ูพุงูโูุง FPGA](#ูฺฏุงุดุช-ูพุงูโูุง-fpga)
- [ูุซุงูโูุง ุงุณุชูุงุฏู](#ูุซุงูโูุง-ุงุณุชูุงุฏู)

---

## ููุฏูู

ูุงฺูู `top_level` ุณุณุชู ููู ุฏุฌุชุงู ูุจุชู ุจุฑ ุงูฺฏู ฺฉุงูู ุงุณุช. ุงู ูุงฺูู ูุชุตู ูโฺฉูุฏ:

1. **ฺูุงุฑ ุญุฐูโฺฉููุฏู ููุณุงู ุฏฺฉูู**: ูพุงฺฉโุณุงุฒ ูุฑูุฏโูุง ุฎุงู ุฏฺฉูู
2. **ฺฉ ฺฉูุชุฑูุฑ ูุงุดู ุญุงูุช**: ูพุฑุฏุงุฒุด ุฏฺฉููโูุง ุญุฐู ููุณุงู ุดุฏู ู ูุฏุฑุช ูุถุนุช ููู
3. **ุณฺฏูุงูโูุง ุฎุฑูุฌ**: ุงุฑุงุฆู ูุถุนุช ููู ุจู LED ุง ุณุงุฑ ูุดุงูฺฏุฑูุง

ุงู ูุงฺูู ุงุณุช ฺฉู ุณูุชุฒ ูโฺฉูุฏ ู ุฑู FPGA ูุณุชูุฑ ูโููุงุฏ.

<details>
<summary>ูุงฺูู ุณุทุญ ุจุงูุง ฺุณุชุ</summary>

ุฏุฑ ฺฉ ุทุฑุงุญ ุณุฎุชโุงูุฒุงุฑุ **ูุงฺูู ุณุทุญ ุจุงูุง** ุฎุงุฑุฌโุชุฑู ุธุฑู ุงุณุช ฺฉู:
- ูพุงูโูุง ุฏุงุฑุฏ ฺฉู ุจู ุฏูุง ุจุฑูู ูุชุตู ูโุดููุฏ (ุฏฺฉููโูุงุ LEDูุง ู ุบุฑู)
- ููู ูุงฺููโูุง ุฏฺฏุฑ ุฑุง ุจู ุนููุงู ุฒุฑูุฌููุนู ุฏุฑ ุจุฑ ูโฺฏุฑุฏ
- ฺุฒ ุงุณุช ฺฉู ูุงูุนุงู ุณูุชุฒ ูโฺฉูุฏ ู ุฑู FPGA ุจุงุฑฺฏุฐุงุฑ ูโููุงุฏ

ุขู ุฑุง ูุงููุฏ ุชุงุจุน ยซmain()ยป ุฏุฑ ูุฑูโุงูุฒุงุฑ ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ - ุฌุง ุงุณุช ฺฉู ููู ฺุฒ ฺฏุฑุฏ ูู ูโุขุฏ.

</details>

---

## ูููุฏุงุฑ ุจููฺฉ ุณุณุชู

![ูููุฏุงุฑ ุจููฺฉ ุณุณุชู](../presentation/assets/System-Block-Diagram.png)

---

## ูุงุณุท ููุฌูุฏุช

```vhdl
entity top_level is
    Generic (
        DEBOUNCE_TIME : integer := 10;
        UNLOCK_TIME   : integer := 5
    );
    Port (
        clk          : in  std_logic;
        reset        : in  std_logic;
        button_A_raw : in  std_logic;
        button_B_raw : in  std_logic;
        button_C_raw : in  std_logic;
        button_D_raw : in  std_logic;
        lock_status  : out std_logic;
        led          : out std_logic
    );
end top_level;
```

### ูพุงุฑุงูุชุฑูุง ุนููู

| ูพุงุฑุงูุชุฑ | ููุน | ููุฏุงุฑ ูพุดโูุฑุถ | ุชูุถุญุงุช |
|---------|-----|---------------|---------|
| `DEBOUNCE_TIME` | integer | ฑฐ | ุณฺฉูโูุง ฺฉูุงฺฉ ุจุฑุง ุญุฐู ููุณุงู ุฏฺฉูู |
| `UNLOCK_TIME` | integer | ต | ุณฺฉูโูุง ฺฉูุงฺฉ ูุจู ุงุฒ ููู ุฎูุฏฺฉุงุฑ ูุฌุฏุฏ |

### ูพูุฑุชโูุง

| ูพูุฑุช | ุฌูุช | ููุน | ุชูุถุญุงุช |
|------|-----|-----|---------|
| `clk` | ูุฑูุฏ | std_logic | ฺฉูุงฺฉ ุณุณุชู (ูุซูุงู ฑฐฐ ูฺฏุงูุฑุชุฒ ุงุฒ ููุณุงูโุณุงุฒ FPGA) |
| `reset` | ูุฑูุฏ | std_logic | ุจุงุฒูุดุงู ุณุณุชูุ ูุนุงู-ุจุงูุง |
| `button_A_raw` | ูุฑูุฏ | std_logic | ูุฑูุฏ ุฎุงู ุฏฺฉูู A (ุงุฒ ุฏฺฉูู ูุฒฺฉ) |
| `button_B_raw` | ูุฑูุฏ | std_logic | ูุฑูุฏ ุฎุงู ุฏฺฉูู B |
| `button_C_raw` | ูุฑูุฏ | std_logic | ูุฑูุฏ ุฎุงู ุฏฺฉูู C |
| `button_D_raw` | ูุฑูุฏ | std_logic | ูุฑูุฏ ุฎุงู ุฏฺฉูู D (ูุฑุจโุฏููุฏู) |
| `lock_status` | ุฎุฑูุฌ | std_logic | '1' = ุจุงุฒุ '0' = ููู |
| `led` | ุฎุฑูุฌ | std_logic | ููุงู lock_status (ุจุฑุง ูุดุงูฺฏุฑ LED) |

<details>
<summary>ฺุฑุง ุฏู ุฎุฑูุฌ ฺฉุณุงู (lock_status ู led)ุ</summary>

ุฏุงุดุชู ุฎุฑูุฌโูุง ุฌุฏุงฺฏุงูู ุจุฑุง ููุงู ุณฺฏูุงู ูุฑุงูู ูโฺฉูุฏ:
- **ูุถูุญ**: ูุงูโูุง ูุฎุชูู ุจุฑุง ุงูุฏุงู ูุฎุชูู
- **ุงูุนุทุงูโูพุฐุฑ**: ูโุชูุงู ุฑูุชุงุฑูุง ูุฎุชูู ุจุนุฏุงู ุงุถุงูู ฺฉุฑุฏ
- **ูฺฏุงุดุช FPGA**: ููฺฉู ุงุณุช ุจุฎูุงูุฏ ุจู ูพุงูโูุง ูุฎุชูู ูุณุฑุงุจ ฺฉูุฏ

ุฏุฑ ูพุงุฏูโุณุงุฒ ูุนูุ ูุฑ ุฏู ฺฉุณุงู ูุณุชูุฏ: `led <= lock_status`

</details>

---

## ูุนูุงุฑ

### ุณฺฏูุงูโูุง ุฏุงุฎู

```vhdl
signal button_A_debounced : std_logic;
signal button_B_debounced : std_logic;
signal button_C_debounced : std_logic;
signal button_D_debounced : std_logic;
signal lock_status_internal : std_logic;
```

| ุณฺฏูุงู | ุชูุถุญุงุช |
|--------|---------|
| `button_X_debounced` | ุณฺฏูุงูโูุง ุชูุฒ ู ุชฺฉโูพุงูุณ ุงุฒ ุญุฐูโฺฉููุฏูโูุง ููุณุงู |
| `lock_status_internal` | ูุถุนุช ุฏุงุฎู ููู (ูุจู ุงุฒ ุจุงูุฑ ุฎุฑูุฌ) |

### ุงุนูุงูโูุง ุงุฌุฒุง

```vhdl
component button_debouncer
    Generic (DEBOUNCE_TIME : integer := 10);
    Port (
        clk        : in  std_logic;
        reset      : in  std_logic;
        button_in  : in  std_logic;
        button_out : out std_logic
    );
end component;

component digital_lock
    Generic (UNLOCK_TIME : integer := 5);
    Port (
        clk          : in  std_logic;
        reset        : in  std_logic;
        button_A     : in  std_logic;
        button_B     : in  std_logic;
        button_C     : in  std_logic;
        button_D     : in  std_logic;
        lock_status  : out std_logic
    );
end component;
```

<details>
<summary>ุงุนูุงูโูุง ุฌุฒุก ฺุณุชุ</summary>

ุฏุฑ VHDLุ ูุจู ุงุฒ ุงูฺฉู ุจุชูุงูุฏ ฺฉ ูุงฺูู ุฑุง ุงุณุชูุงุฏู (ูููููโุณุงุฒ) ฺฉูุฏุ ุจุงุฏ ุจู ฺฉุงููพุงูุฑ ุจฺฏูุฏ ฺฉู ฺู ุดฺฉู ุฏุงุฑุฏ. ฺฉ **ุงุนูุงู ุฌุฒุก** ูุงููุฏ ฺฉ ุงุนูุงู ูพุดุฑู ุฏุฑ C ุงุณุช - ูโฺฏูุฏ ยซุงู ฺุฒ ูุฌูุฏ ุฏุงุฑุฏ ู ุงู ูพูุฑุชโูุง ุฑุง ุฏุงุฑุฏ.ยป

ุจุนุฏุงูุ ุฌุฒุก ุฑุง **ูููููโุณุงุฒ** ูโฺฉูุฏ ู ฺฉ ููููู ูุงูุน ุงุฒ ุขู ุงุฌุงุฏ ูโฺฉูุฏ.

</details>

---

## ุงุชุตุงูุงุช ุงุฌุฒุง

### ูููููโุณุงุฒโูุง ุญุฐูโฺฉููุฏู ููุณุงู

```vhdl
debounce_A: button_debouncer
    generic map (DEBOUNCE_TIME => DEBOUNCE_TIME)
    port map (
        clk        => clk,
        reset      => reset,
        button_in  => button_A_raw,
        button_out => button_A_debounced
    );

-- ูุดุงุจู ุจุฑุง Bุ Cุ D...
```

**ุฌุฑุงู ุฏุงุฏู**:
```
button_A_raw (ููุฒ) โ ุญุฐูโฺฉููุฏู A โ button_A_debounced (ูพุงูุณ ุชูุฒ)
```

### ูููููโุณุงุฒ ฺฉูุชุฑูุฑ ูุงุดู ุญุงูุช

```vhdl
lock_fsm: digital_lock
    generic map (UNLOCK_TIME => UNLOCK_TIME)
    port map (
        clk          => clk,
        reset        => reset,
        button_A     => button_A_debounced,
        button_B     => button_B_debounced,
        button_C     => button_C_debounced,
        button_D     => button_D_debounced,
        lock_status  => lock_status_internal
    );
```

### ุชุฎุตุตโูุง ุฎุฑูุฌ

```vhdl
lock_status <= lock_status_internal;
led <= lock_status_internal;
```

---

## ุฑุงูููุง ูพฺฉุฑุจูุฏ

### ุจุฑุง ุดุจูโุณุงุฒ

ุงุฒ ููุงุฏุฑ ฺฉูฺฺฉ ุจุฑุง ุดุจูโุณุงุฒ ุณุฑุน ุงุณุชูุงุฏู ฺฉูุฏ:

```vhdl
-- ุฏุฑ ูููููโุณุงุฒ ุชุณุชโุจูฺ
uut: entity work.top_level
    generic map (
        DEBOUNCE_TIME => 5,    -- ต ุณฺฉู ฺฉูุงฺฉ
        UNLOCK_TIME   => 3     -- ณ ุณฺฉู ฺฉูุงฺฉ
    )
    port map (...);
```

### ุจุฑุง ุณุฎุชโุงูุฒุงุฑ ูุงูุน

ููุงุฏุฑ ููุงุณุจ ุฑุง ุจุฑ ุงุณุงุณ ฺฉูุงฺฉ ุฎูุฏ ูุญุงุณุจู ฺฉูุฏ:

| ฺฉูุงฺฉ | ุญุฐู ููุณุงู (ฒฐ ููโุซุงูู) | ุจุงุฒ ฺฉุฑุฏู (ต ุซุงูู) |
|------|---------------------------|-------------------|
| ตฐ ูฺฏุงูุฑุชุฒ | ฑูฌฐฐฐูฌฐฐฐ | ฒตฐูฌฐฐฐูฌฐฐฐ |
| ฑฐฐ ูฺฏุงูุฑุชุฒ | ฒูฌฐฐฐูฌฐฐฐ | ตฐฐูฌฐฐฐูฌฐฐฐ |
| ฑฒต ูฺฏุงูุฑุชุฒ | ฒูฌตฐฐูฌฐฐฐ | ถฒตูฌฐฐฐูฌฐฐฐ |

<details>
<summary>ูุฑูููโูุง ูุญุงุณุจู</summary>

```
DEBOUNCE_TIME = ุซุงูู_ุญุฐู_ููุณุงู ร ูุฑฺฉุงูุณ_ฺฉูุงฺฉ
UNLOCK_TIME = ุซุงูู_ุจุงุฒ ร ูุฑฺฉุงูุณ_ฺฉูุงฺฉ
```

ูุซุงู ุจุฑุง ฺฉูุงฺฉ ฑฐฐ ูฺฏุงูุฑุชุฒ:
- ุญุฐู ููุณุงู ฒฐ ููโุซุงูู: ฐ.ฐฒฐ ร ฑฐฐูฌฐฐฐูฌฐฐฐ = ฒูฌฐฐฐูฌฐฐฐ
- ุจุงุฒ ฺฉุฑุฏู ต ุซุงูู: ต.ฐ ร ฑฐฐูฌฐฐฐูฌฐฐฐ = ตฐฐูฌฐฐฐูฌฐฐฐ

</details>

---

## ูฺฏุงุดุช ูพุงูโูุง FPGA

### ูุญุฏูุฏุชโูุง Xilinx Vivado (ูุซุงู ุจุฑุง Basys3)

```tcl
# ฺฉูุงฺฉ (ููุณุงูโุณุงุฒ ฑฐฐ ูฺฏุงูุฑุชุฒ)
set_property PACKAGE_PIN W5 [get_ports clk]
set_property IOSTANDARD LVCMOS33 [get_ports clk]
create_clock -period 10.000 [get_ports clk]

# ุจุงุฒูุดุงู (ุฏฺฉูู ูุฑฺฉุฒ)
set_property PACKAGE_PIN U18 [get_ports reset]
set_property IOSTANDARD LVCMOS33 [get_ports reset]

# ุฏฺฉููโูุง (ุฏฺฉููโูุง ุณูุช ุฑุงุณุช)
set_property PACKAGE_PIN T18 [get_ports button_A_raw]
set_property PACKAGE_PIN W19 [get_ports button_B_raw]
set_property PACKAGE_PIN T17 [get_ports button_C_raw]
set_property PACKAGE_PIN U17 [get_ports button_D_raw]
set_property IOSTANDARD LVCMOS33 [get_ports button_*_raw]

# LEDูุง
set_property PACKAGE_PIN U16 [get_ports lock_status]
set_property PACKAGE_PIN E19 [get_ports led]
set_property IOSTANDARD LVCMOS33 [get_ports lock_status]
set_property IOSTANDARD LVCMOS33 [get_ports led]
```

<details>
<summary>ูุญูู ุงุฌุงุฏ ูุงู ูุญุฏูุฏุชโูุง</summary>

1. ฺฉ ูุงู ุจู ูุงู `constraints.xdc` ุฏุฑ ูพูุดู `synthesis/` ุงุฌุงุฏ ฺฉูุฏ
2. ูฺฏุงุดุช ูพุงูโูุง ุฑุง ุจุฑุง ุจุฑุฏ FPGA ุฎุงุต ุฎูุฏ ุงุถุงูู ฺฉูุฏ
3. ุฏุฑ Vivado: Add Sources โ Add or create constraints โ ูุงู .xdc ุฑุง ุงุถุงูู ฺฉูุฏ
4. ุณูุชุฒ ู ูพุงุฏูโุณุงุฒ ุฑุง ุงุฌุฑุง ฺฉูุฏ

ูุฑ ุจุฑุฏ FPGA ุชุฎุตุต ูพุงู ูุชูุงูุช ุฏุงุฑุฏ - ูุณุชูุฏุงุช ุจุฑุฏ ุฎูุฏ ุฑุง ุจุฑุฑุณ ฺฉูุฏ!

</details>

### ูุญุฏูุฏุชโูุง Intel/Altera Quartus (ูุซุงู)

```tcl
# ุฏุฑ ฺฉ ูุงู .qsf
set_location_assignment PIN_R8 -to clk
set_location_assignment PIN_J15 -to reset
set_location_assignment PIN_H21 -to button_A_raw
set_location_assignment PIN_H22 -to button_B_raw
set_location_assignment PIN_G20 -to button_C_raw
set_location_assignment PIN_G21 -to button_D_raw
set_location_assignment PIN_L21 -to lock_status
set_location_assignment PIN_L22 -to led
```

---

## ูุซุงูโูุง ุงุณุชูุงุฏู

### ุฏุณุชูุฑ ุณูุชุฒ (GHDL)

```bash
# ุจุฑุฑุณ ูุงุจูุช ุณูุชุฒ
ghdl --synth --std=08 top_level
```

### ูููููโุณุงุฒ ุชุณุชโุจูฺ

```vhdl
uut: entity work.top_level
    generic map (
        DEBOUNCE_TIME => 5,
        UNLOCK_TIME   => 3
    )
    port map (
        clk          => clk,
        reset        => reset,
        button_A_raw => test_button_A,
        button_B_raw => test_button_B,
        button_C_raw => test_button_C,
        button_D_raw => test_button_D,
        lock_status  => test_lock_status,
        led          => open  -- ูุชุตู ูุดุฏู (ููู ูุณุช)
    );
```

<details>
<summary>ูุนู ยซopenยป ฺุณุชุ</summary>

ุฏุฑ VHDLุ `open` ุจู ูุนู ยซูุชุตู ูุดุฏูยป ุง ยซููู ูุณุชยป ุงุณุช. ุงุฒ ุขู ุจุฑุง ูพูุฑุชโูุง ุฎุฑูุฌ ฺฉู ูุงุฒ ุจู ูุธุงุฑุช ูุฏุงุฑุฏ ุงุณุชูุงุฏู ฺฉูุฏ.

```vhdl
led => open  -- ูุงุฒ ุจู ุฎูุงูุฏู ุงู ุฎุฑูุฌ ูุฏุงุฑู
```

ุงู ููุท ุจุฑุง ูพูุฑุชโูุง ุฎุฑูุฌ ูุนุชุจุฑ ุงุณุชุ ูุฑฺฏุฒ ุจุฑุง ูุฑูุฏโูุง.

</details>

### ุงุฌุงุฏ ฺฉ ูพูุดุด ุดุจูโุณุงุฒ

ุจุฑุง ุดุจูโุณุงุฒ ุจุง ุฒูุงูโุจูุฏ ูุชูุงูุช:

```vhdl
-- ุฏุฑ ุชุณุชโุจูฺ
constant SIM_DEBOUNCE : integer := 5;   -- ุณุฑุน ุจุฑุง ุดุจูโุณุงุฒ
constant SIM_UNLOCK   : integer := 10;  -- ุชุงุฎุฑ ุณุฑุน

uut: entity work.top_level
    generic map (
        DEBOUNCE_TIME => SIM_DEBOUNCE,
        UNLOCK_TIME   => SIM_UNLOCK
    )
    port map (...);
```

---

## ุชุตููุงุช ุทุฑุงุญ

### ฺุฑุง ูพุงุฑุงูุชุฑูุง ุนููู ุฏุฑ ุณุทุญ ุจุงูุงุ

ุงุฑุณุงู ูพุงุฑุงูุชุฑูุง ุนููู ุงุฒ ุทุฑู ุณุทุญ ุจุงูุง:
- **ููุทู ูพฺฉุฑุจูุฏ ูุงุญุฏ**: ุชุบุฑ ุฒูุงูโุจูุฏ ุฏุฑ ฺฉ ูฺฉุงู
- **ุชุณุช ุขุณุงู**: ุงุณุชูุงุฏู ุงุฒ ููุงุฏุฑ ฺฉูฺฺฉ ุจุฑุง ุดุจูโุณุงุฒ
- **ุงุณุชูุฑุงุฑ ุขุณุงู**: ุงุณุชูุงุฏู ุงุฒ ููุงุฏุฑ ูุงูุนโฺฏุฑุงุงูู ุจุฑุง ุณุฎุชโุงูุฒุงุฑ
- **ุจุฏูู ุชุบุฑ ฺฉุฏ**: ููุงู ููุจุน ุจุฑุง ูุฑ ุฏู ฺฉุงุฑ ูโฺฉูุฏ

### ฺุฑุง ูุถุนุช ููู ู LED ุฌุฏุงฺฏุงููุ

ุงูุนุทุงูโูพุฐุฑ ุจุฑุง ุจูุจูุฏูุง ุขูุฏู:
- ูุดุงูฺฏุฑูุง ูุฎุชูู ุจุฑุง ุฎุฑูุฌโูุง ูุฎุชูู
- ุฎุท ูุถุนุช ุจู ุณุงุฑ ุณุณุชูโูุง ุฏุฌุชุงู
- LED ูโุชูุงูุฏ ฺุดูฺฉ ุจุฒูุฏ ุง ุงูฺฏููุง ูุฎุชูู ุฏุงุดุชู ุจุงุดุฏ
- ุงุตูุงุญ ุขุณุงู ุจุฏูู ุชุบุฑ ูุงุดู ุญุงูุช

### ฺุฑุง ุงุฒ ูููููโุณุงุฒ ูุณุชูู ููุฌูุฏุช ุงุณุชูุงุฏู ูุดุฏุ

ฺฉุฏ ุงุฒ ุงุนูุงูโูุง ุฌุฒุก ุจุฑุง ุณุงุฒฺฏุงุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ:
- ุจุง ููู ุงุณุชุงูุฏุงุฑุฏูุง VHDL ฺฉุงุฑ ูโฺฉูุฏ (ธทุ นณุ ฒฐฐธ)
- ุจุฑุฎ ุงุจุฒุงุฑูุง ุณูุชุฒ ุงู ุณุจฺฉ ุฑุง ุชุฑุฌุญ ูโุฏููุฏ
- ุงุนูุงูโูุง ุตุฑุญ ุฌุฒุก ูุงุณุท ุฑุง ูุณุชูุฏ ูโฺฉููุฏ

ูููููโุณุงุฒ ูุณุชูู (`entity work.module`) ุชูุฒุชุฑ ุงุณุช ุงูุง ูุงุฒ ุจู VHDL-93 ุง ุจุงูุงุชุฑ ุฏุงุฑุฏ.
